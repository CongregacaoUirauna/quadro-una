<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Painel Administrativo - Escala da Congregação</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; max-width: 800px; margin: 0 auto; }
        .section { border: 1px solid #ccc; padding: 15px; margin-bottom: 20px; border-radius: 5px; }
        label { display: block; margin-top: 10px; font-weight: bold; font-size: 14px;}
        input { width: 100%; padding: 8px; margin-top: 5px; box-sizing: border-box; }
        button { background-color: #4CAF50; color: white; padding: 10px 15px; border: none; cursor: pointer; font-size: 16px; margin-top: 15px; }
        button:hover { background-color: #45a049; }
        #mensagem, #loginMensagem { margin-top: 15px; font-weight: bold; }
        
        /* Controle de visibilidade */
        #painelSistema { display: none; } 
        #telaLogin { max-width: 400px; margin: 50px auto; text-align: center; }
    </style>
</head>
<body>

    <div id="telaLogin" class="section">
        <h2>Acesso Restrito</h2>
        <input type="email" id="emailLogin" placeholder="Seu E-mail" required>
        <input type="password" id="senhaLogin" placeholder="Sua Senha" required>
        <button id="btnEntrar">Entrar</button>
        <div id="loginMensagem"></div>
    </div>

    <div id="painelSistema">
        <h1>Painel de Designações Semanais</h1>
        <button id="btnSair" style="background-color: #f44336; margin-bottom: 20px;">Sair do Sistema</button>
        
        <div class="section">
            <label for="dataReuniao">Data da Reunião (Identificador Único):</label>
            <input type="date" id="dataReuniao" required>
            
            <label for="presidente">Presidente da Reunião:</label>
            <input type="text" id="presidente" placeholder="Ex: Francisco Nunes">
        </div>

        <div class="section">
            <h3>Abertura</h3>
            <label for="canticoInicial">Cântico Inicial (Número):</label>
            <input type="number" id="canticoInicial">
            <label for="oracaoInicial">Oração Inicial:</label>
            <input type="text" id="oracaoInicial">
            <label for="comentariosIniciais">Comentários Iniciais (1 min):</label>
            <input type="text" id="comentariosIniciais">
        </div>

        <div class="section">
            <h3>Tesouros da Palavra de Deus</h3>
            <label for="parte1">Parte 1 - Discurso Principal (10 min):</label>
            <input type="text" id="parte1">
            <label for="parte2">Parte 2 - Joias Espirituais (10 min):</label>
            <input type="text" id="parte2">
            <label for="leituraBiblia">Parte 3 - Leitura da Bíblia (4 min):</label>
            <input type="text" id="leituraBiblia">
        </div>

        <button id="btnSalvar">Salvar Programação</button>
        <div id="mensagem"></div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
        import { getFirestore, doc, setDoc } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";
        import { getAuth, signInWithEmailAndPassword, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js";

        // Sua configuração do Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyC3U8tyPk5IB_y51-3d7_6V-16qtoqzeI8",
            authDomain: "quadro-congregacao.firebaseapp.com",
            projectId: "quadro-congregacao",
            storageBucket: "quadro-congregacao.firebasestorage.app",
            messagingSenderId: "1085145636546",
            appId: "1:1085145636546:web:69d340e69f28814a1de55b"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const auth = getAuth(app);

        // Elementos da Interface
        const telaLogin = document.getElementById('telaLogin');
        const painelSistema = document.getElementById('painelSistema');
        const loginMensagem = document.getElementById('loginMensagem');

        // LÓGICA DE AUTENTICAÇÃO
        onAuthStateChanged(auth, (user) => {
            if (user) {
                // Usuário está logado
                telaLogin.style.display = 'none';
                painelSistema.style.display = 'block';
            } else {
                // Usuário não está logado
                telaLogin.style.display = 'block';
                painelSistema.style.display = 'none';
            }
        });

        document.getElementById('btnEntrar').addEventListener('click', async () => {
            const email = document.getElementById('emailLogin').value;
            const senha = document.getElementById('senhaLogin').value;
            loginMensagem.innerText = "Verificando...";
            
            try {
                await signInWithEmailAndPassword(auth, email, senha);
                loginMensagem.innerText = ""; 
            } catch (error) {
                loginMensagem.style.color = "red";
                loginMensagem.innerText = "Erro ao fazer login. Verifique e-mail e senha.";
                console.error(error);
            }
        });

        document.getElementById('btnSair').addEventListener('click', () => {
            signOut(auth);
        });

        // LÓGICA DE SALVAMENTO NO BANCO DE DADOS
        document.getElementById('btnSalvar').addEventListener('click', async () => {
            const dataReuniao = document.getElementById('dataReuniao').value;
            const msgDiv = document.getElementById('mensagem');

            if (!dataReuniao) {
                msgDiv.style.color = "red";
                msgDiv.innerText = "Por favor, selecione a data da reunião.";
                return;
            }

            msgDiv.style.color = "blue";
            msgDiv.innerText = "Salvando...";

            const programacaoData = {
                data: dataReuniao,
                presidente: document.getElementById('presidente').value,
                abertura: {
                    cantico: document.getElementById('canticoInicial').value,
                    oracao: document.getElementById('oracaoInicial').value,
                    comentarios: document.getElementById('comentariosIniciais').value
                },
                tesouros: {
                    parte_1: document.getElementById('parte1').value,
                    parte_2: document.getElementById('parte2').value,
                    leitura: document.getElementById('leituraBiblia').value
                }
            };

            try {
                await setDoc(doc(db, "programacoes_semanais", dataReuniao), programacaoData);
                msgDiv.style.color = "green";
                msgDiv.innerText = "Programação salva com sucesso!";
            } catch (error) {
                console.error("Erro ao salvar: ", error);
                msgDiv.style.color = "red";
                msgDiv.innerText = "Erro ao salvar. Verifique o console.";
            }
        });
    </script>
</body>
</html>
